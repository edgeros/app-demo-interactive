(()=>{"use strict";var e,t;(t=e||(e={}))[t.onlyTop=1]="onlyTop",t[t.preferTop=2]="preferTop",t[t.desktop=3]="desktop";const o={active:[],deactive:[],login:[],logout:[],pay:[],orientation:[],network:[],swipe:[],token:[],permission:[],wallpaper:[],theme:[],language:[]};window.addEventListener("message",(e=>{const t=e.data.cmd;o[t]&&(o[t].forEach(((t,o)=>{if("function"==typeof t)if(t.__edger_uid__){const o=e.data.uid;t.__edger_uid__===o&&(t(e.data.payload,e.data.error),t.__edger_done__=!0)}else t(e.data.payload,e.data.error)})),o[t]=o[t].filter((e=>!0!==e.__edger_done__)))}));const r=(e,t)=>{const r=e;o[r]?o[r].push(t):o[r]=[t]},n=(t,o=e.preferTop)=>{o===e.preferTop?window.parent===window.parent.parent?(console.warn("No app shell, downgrade to desktop",t),window.parent.postMessage({...t},"*")):window.parent.parent.postMessage({...t},"*"):o===e.onlyTop?window.parent===window.parent.parent?console.warn("No app shell, ignore message",t):window.parent.parent.postMessage({...t},"*"):window.parent.postMessage({...t},"*")};let i=0;const s=(t,o,s={timeout:1e3,ignoreResponse:!0,deliverStrategy:e.preferTop,disableTimeout:!1},a="")=>{if(!t)throw new Error("Illegal cmd");const{timeout:p=1e3,ignoreResponse:d=!0,deliverStrategy:l,disableTimeout:g=!1}=s;return new Promise(((e,s)=>{if(d)n({cmd:t,payload:o,ts:Date.now()},l),e(void 0);else{const d=`${Math.random()}-${Date.now()}-${i++}`,c=function(t,o){o?(console.error("error",o),s({error:o})):e(t)};c.__edger_uid__=d,r(t,c),n({cmd:t,payload:o,uid:d,ts:Date.now(),scope:a},l),g||setTimeout((()=>{s({error:`Timeout ${p} with cmd ${t}`,code:"timeout"})}),p||6e4)}}))},a=(t,r)=>{const n=o[t];n?(n.push(r),s("__edgeros_register_event__",{action:t},{deliverStrategy:e.desktop,ignoreResponse:!0})):console.warn(`The action you specified is unknown: ${t}`)},p={height:0,activeElement:{el:null,originToBottomHeight:0}},d={open:(t,o)=>s("open",{target:t,letter:o},{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:12e4}),appworld:t=>s("openAppInWorld",{target:{id:t}},{ignoreResponse:!1,timeout:12e4,deliverStrategy:e.desktop}),letter:()=>s("letter",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:e.desktop})},l={request:t=>s("reqPerms",{code:t.code,type:t.type},{ignoreResponse:!1,timeout:12e4,deliverStrategy:e.desktop}),fetch:()=>s("permission",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop})},g={qrscan:()=>s("qrscan",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:3e5,disableTimeout:!0}),qrscanStop:()=>{s("qrscanStop",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4})},contacts:()=>s("contacts",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:5e4})},c={state:()=>s("orientation",{},{deliverStrategy:e.preferTop,ignoreResponse:!1}),lock:t=>s("setOrientation",{type:"lock",orientation:t},{deliverStrategy:e.preferTop,ignoreResponse:!1}),unlock:()=>s("setOrientation",{type:"unlock"},{deliverStrategy:e.preferTop,ignoreResponse:!1})};var m,u;const y={_on:r,_off:function(e){const t=e;return this.removeAllListeners(t)},_emit:n,_cmd:s,onAction:a,addEventListener:function(t,r){if("function"!=typeof r)throw new TypeError("listener must be a function");const n=o[t];return n&&(n.push(r),s("__edgeros_register_event__",{action:t},{deliverStrategy:e.desktop,ignoreResponse:!0})),this},removeEventListener:function(e,t){if("function"!=typeof t)throw new TypeError("listener must be a function");return o[e]&&(o[e]=o[e].filter((e=>e!==t))),this},removeAllListeners:function(e){return e?o[e]&&(o[e]=[]):Object.keys(o).forEach((e=>{o[e]&&(o[e]=[])})),this},user:()=>s("user",{},{ignoreResponse:!1,timeout:200,deliverStrategy:e.desktop}),avoidKeyboardOverlay:(t="#app",o=".van-dialog")=>window.addEventListener("message",(r=>{if("keyboardHeight"===r.data.cmd){let i=0,s=document.querySelector(t);const a=document.documentElement.clientHeight||document.body.clientHeight,d=document.activeElement;let l=document.activeElement;const g=+r.data.payload.keyboardHeight,c=document.querySelectorAll(o),m=Array.from(c).filter((e=>"none"!==e.style.display))[0],u=m&&"none"!==m.style.display;if(u&&(s=m,l=m,i=l.getBoundingClientRect().top),s.style.transition||(s.style.transition="margin-top .3s ease-in-out"),g||(p.height=0,p.activeElement.el=null,p.activeElement.originToBottomHeight=0,s.style.marginTop="0px"),g>0&&d&&("INPUT"===d.tagName.toUpperCase()||"TEXTAREA"===d.tagName.toUpperCase())){let t=!1,o=a-l.getBoundingClientRect().bottom;if(p.height){const e=p.activeElement.originToBottomHeight;if(e){let r=0;try{r=parseFloat(getComputedStyle(s).marginTop.replace(/[px ]/g,""))}catch(e){console.error("计算keyboard marginTop出错",e)}let n=a-d.getBoundingClientRect().bottom+r,i=0,l=40;p.activeElement.el&&(l=10,i=a-p.activeElement.el.getBoundingClientRect().bottom+r-p.activeElement.originToBottomHeight),n-=i,t=Math.abs(n-e)>l,o=t?n:e}}if(!t&&g<=p.height&&p.height-g<150)return;if(t||o<g){p.activeElement.el=d,p.activeElement.originToBottomHeight=o,p.height=g;let t=o-g;i>0&&(t=i-Math.abs(t)>25?t:25-i),t>=0&&(t=0),s.style.marginTop=t+"px",u||n({cmd:"switchStatusBar",payload:"hide"},e.onlyTop)}}else s.style.marginTop="0px",c.length&&Array.from(c).forEach((e=>e.style.marginTop="0px")),n({cmd:"switchStatusBar",payload:"show"},e.onlyTop)}})),app:d,notify:(m={},u=t=>{t&&["info","warning","error","success"].forEach((o=>{t[o]=t=>{s("notify",{message:t,level:o},{deliverStrategy:e.desktop,ignoreResponse:!0})}}))},m?u(m):console.error("target object is null"),m),mobile:g,permission:l,pay:t=>s("pay",t,{deliverStrategy:e.desktop}),apps:(t,o=!1)=>s("apps",{appids:t,ico:o},{deliverStrategy:e.desktop,ignoreResponse:!1}),orientation:c,network:()=>s("network",{},{ignoreResponse:!1,deliverStrategy:e.preferTop}),language:()=>s("language",{},{deliverStrategy:e.desktop,ignoreResponse:!1}),version:()=>s("version",{},{ignoreResponse:!1,timeout:200,deliverStrategy:e.desktop}),token:()=>s("token",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:e.desktop}),enableHistoryNavigation:()=>{window.sessionStorage.getItem("entryPath")||window.sessionStorage.setItem("entryPath",window.location.href),a("swipe",(function(e){"left"!==e.direction&&"right"!==e.direction||(window.sessionStorage.getItem("entryPath")!==window.location.href?window.history.back():n({cmd:"minEap"},3))}))},theme:()=>s("theme",{},{ignoreResponse:!1,timeout:200,deliverStrategy:e.preferTop}),env:()=>s("env",{},{ignoreResponse:!1,timeout:1e3,deliverStrategy:e.preferTop})};((t=10)=>{setInterval((()=>{s("ping",{},{ignoreResponse:!0,timeout:200,deliverStrategy:e.desktop})}),1e3*t)})(30),s("__edgeros_register__",{},{deliverStrategy:e.desktop,ignoreResponse:!0}),window.edger=y})();